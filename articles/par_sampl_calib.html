<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Parameter sampling and model calibration â€¢ SWATplusR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Parameter sampling and model calibration">
<meta property="og:description" content="SWATplusR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SWATplusR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.5.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/SWATplusR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/par_sampl_calib.html">Parameter sampling and model calibration</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/chrisschuerz/SWATplusR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Parameter sampling and model calibration</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/chrisschuerz/SWATplusR/blob/HEAD/vignettes/par_sampl_calib.Rmd" class="external-link"><code>vignettes/par_sampl_calib.Rmd</code></a></small>
      <div class="hidden name"><code>par_sampl_calib.Rmd</code></div>

    </div>

    
    
<p><strong>This article is still work in progress. You can use already some parts of it as recipes for your work. The demonstrated example is, however, still not usable for any calibration.</strong></p>
<div class="section level2">
<h2 id="aim-of-this-article">Aim of this article<a class="anchor" aria-label="anchor" href="#aim-of-this-article"></a>
</h2>
<p>This article should give you a general idea on how you can integrate <code>SWATplusR</code> in typical model calibration routines. There are many ways to approach model calibration, but one of the most frequent ways is to sample a set of parameter combinations, run the model, evaluate the simulation outputs and either perform further simulations or consider the model as acceptably calibrated (well that usually does not happen after one round of simulations). Therefore the article will address the following tasks: - Sampling SWAT parameter combinations using the two approaches, random and Latin Hypercube Sampling (LHS) - Performing model simulations with <code>SWATplusR</code> (using parallel processing to speed things up) - Evaluating model simulations, by using performance criteria which are well established in hydrology</p>
</div>
<div class="section level2">
<h2 id="r-packages">R packages<a class="anchor" aria-label="anchor" href="#r-packages"></a>
</h2>
<p>The examples below use different functions from several <code>R</code> packages. I recommend to install and load already all required packages at this point. I do not explain what the purposes of these packages are, but I will refer to some of them in the eamples below.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># If any of the packages is not installed already run the respective lines here.</span>
<span class="co"># General data science packages</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'dplyr'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'tibble'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'purrr'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'lubridate'</span><span class="op">)</span>

<span class="co"># Latin Hypercube sampling</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'lhs'</span><span class="op">)</span>

<span class="co"># Hydrological model performance metrics</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'hydroGOF'</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/chrisschuerz/SWATplusR" class="external-link">SWATplusR</a></span><span class="op">)</span>

<span class="co"># General data science packages</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org" class="external-link">purrr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>

<span class="co"># Latin Hypercube sampling</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bertcarnell/lhs" class="external-link">lhs</a></span><span class="op">)</span>

<span class="co"># Hydrological model performance metrics</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hzambran/hydroGOF" class="external-link">hydroGOF</a></span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="parameter-sampling">Parameter sampling<a class="anchor" aria-label="anchor" href="#parameter-sampling"></a>
</h2>
<p>Two often used sampling strategies for parameter sampling are to perform a simple generic random sampling, or to use Latin Hypercube Sampling (LHS). You can implement both sampling strategies quite easily in <code>R</code>. To draw random uniform sampling you can simply use the function <code><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif()</a></code> from the base <code>R</code> package <code>stats</code> <span class="citation">(<a href="#ref-Rcore2019" role="doc-biblioref">R Core Team, 2019</a>)</span>. Different LHS sampling routines are available with the package <code>lhs</code> <span class="citation">(<a href="#ref-Carnell2019" role="doc-biblioref">Carnell, 2019</a>)</span>. Other procedures, such as certain methods for parameter sensitivity analysis require specifically tailored sampling schemes. These are often provided with the <code>R</code> packages that you can use to perform sensitivity analysis.</p>
<div class="section level3">
<h3 id="defining-parameter-boundaries">Defining parameter boundaries<a class="anchor" aria-label="anchor" href="#defining-parameter-boundaries"></a>
</h3>
<p>Before we can draw parameter samples we have to define the parameters that we want to include in the parameter set and the ranges in which each parameter should be changed. The names of the parameters follow a specific syntax that controls the type of parameter change and can include further conditions for a parameter change. The parameter syntax is explained in the <a href="https://chrisschuerz.github.io/SWATplusR/articles/SWATplusR.html#changing-parameter-values" class="external-link">Get started</a> section. If you are not familiar with the parameter name syntax already I recommend to have a look there first.</p>
<p>We can define the parameter names and the boundaries for the parameter changes in a <code>tibble</code> <span class="citation">(<a href="#ref-Mueller2019" role="doc-biblioref">MÃ¼ller and Wickham, 2019</a>)</span> that we then can further use in different sampling strategies. I recommend to use a <code>tibble</code> here rather than the synonymous <code>data.frame</code> as the base <code>R</code> data frames may have issues with more complex column names that we require here. The <code>tibble</code> for the parameter boundaries is structured as illustrated in the example below. We define a column name and assign two values which represent the lower and the upper boundaries for possible parameter changes. The example below uses 7 SWAT+ parameters that are often included in model calibration. The first line in the <code>tibble</code> definition can for example be translated as we define the parameter <em>â€˜cn2â€™</em> which is a <em>â€˜.mgtâ€™</em> parameter and we want to change the initial parameter values by adding or substracting absolute values from a range -15 to 10.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">par_bound</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="st">'cn2.hru | change = abschg'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">15</span>, <span class="fl">10</span><span class="op">)</span>,
                    <span class="st">'lat_ttime.hru | change = absval'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">50</span><span class="op">)</span>,
                    <span class="st">'lat_len.hru | change = absval'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">100</span><span class="op">)</span>,
                    <span class="st">'k.sol | change = pctchg'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">50</span>, <span class="fl">50</span><span class="op">)</span>,
                    <span class="st">'awc.sol | change = pctchg'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">50</span>, <span class="fl">50</span><span class="op">)</span>,
                    <span class="st">'esco.hru | change = absval'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,
                    <span class="st">'epco.hru | change = absval'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="random-sampling-with-runif">Random sampling with <code>runif()</code><a class="anchor" aria-label="anchor" href="#random-sampling-with-runif"></a>
</h3>
<p>The most basic way to draw random parameter samples is to use the base R function <code><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif()</a></code>. With <code><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif()</a></code> you can create a uniformly distributed vector. To draw a specific number of parameter sets with <code><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif()</a></code> you have to create a vector with that number of random values for each parameter and transform them to their parameter ranges. Below you find a simple approach to create a table of parameter combinations using a <code>map*()</code> function from the functional programming package <code>purrr</code>. Even if you do not fully understand what the <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_df()</a></code> and the code below does you can use this as a recipe for drawing random uniform samples. This approach should work in your practical cases as well.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n_sample</span> <span class="op">&lt;-</span> <span class="fl">250</span>
<span class="va">par_runif</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_df</a></span><span class="op">(</span><span class="va">par_bound</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_sample</span>, <span class="va">.x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">.x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">par_runif</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 250 x 7</span></span>
<span class="co">#&gt;    `cn2.hru | change ~ `lat_ttime.hru | ch~ `lat_len.hru | ch~ `k.sol | change ~</span>
<span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>                7.30                32.9                52.1            -<span style="color: #BB0000;">49.6</span> </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>              -<span style="color: #BB0000;">12.6</span>                 20.1                52.0             28.5 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>               -<span style="color: #BB0000;">9.43</span>                46.2                96.0             30.3 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>               -<span style="color: #BB0000;">2.93</span>                20.6                12.3             45.8 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>                8.51                10.0                20.5            -<span style="color: #BB0000;">20.8</span> </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>               -<span style="color: #BB0000;">6.99</span>                28.4                35.9             -<span style="color: #BB0000;">7.74</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>               -<span style="color: #BB0000;">3.27</span>                28.0                10.2             12.0 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>               -<span style="color: #BB0000;">2.00</span>                 3.00               36.3             17.4 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>              -<span style="color: #BB0000;">14.9</span>                 40.6                20.1            -<span style="color: #BB0000;">18.5</span> </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span>              -<span style="color: #BB0000;">11.6</span>                 46.4                39.6              1.30</span>
<span class="co">#&gt; <span style="color: #949494;"># ... with 240 more rows, and 3 more variables:</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   awc.sol | change = pctchg &lt;dbl&gt;, esco.hru | change = absval &lt;dbl&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   epco.hru | change = absval &lt;dbl&gt;</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="lhs-sampling-with-randomlhs">LHS sampling with <code>randomLHS()</code><a class="anchor" aria-label="anchor" href="#lhs-sampling-with-randomlhs"></a>
</h3>
<p>In a very similar way as the random sampling you can draw LHS samples by using the function <code><a href="https://rdrr.io/pkg/lhs/man/randomLHS.html" class="external-link">randomLHS()</a></code> from the <code>lhs</code> package. This is my preferred way to sample parameter combinations, as the parameter combinations are better distributed over the parameter space compared to random sampling. Again we can use the defined parameter boundaries to define the LHS parameter set. Again, the code below can be considered as a recipe to perform a sampling that you can simply use in other modeling cases as well.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n_sample</span> <span class="op">&lt;-</span> <span class="fl">250</span>
<span class="va">n_par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">par_bound</span><span class="op">)</span>

<span class="va">par_lhs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lhs/man/randomLHS.html" class="external-link">randomLHS</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_sample</span>, k <span class="op">=</span> <span class="va">n_par</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Perform sampling</span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">.</span>, .name_repair <span class="op">=</span> <span class="st">'minimal'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Convert to a tibble</span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">par_bound</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Assign the parameter names with purrr</span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2_df</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">par_bound</span>, <span class="op">~</span> <span class="op">(</span><span class="va">.x</span> <span class="op">*</span> <span class="op">(</span><span class="va">.y</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">.y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="va">.y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="co"># Scale parameter ranges</span>

<span class="va">par_lhs</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 250 x 7</span></span>
<span class="co">#&gt;    `cn2.hru | change ~ `lat_ttime.hru | ch~ `lat_len.hru | ch~ `k.sol | change ~</span>
<span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>              -<span style="color: #BB0000;">10.1</span>                 47.0                40.9             -<span style="color: #BB0000;">5.56</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>               -<span style="color: #BB0000;">5.89</span>                17.7                77.3             26.1 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>                9.49                40.3                30.5             -<span style="color: #BB0000;">9.59</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>                4.83                 6.02               85.2             34.5 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>                5.34                40.5                26.8             28.8 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>                8.21                 9.73               89.8             32.6 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>                6.28                 8.48               95.7            -<span style="color: #BB0000;">21.1</span> </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>                6.38                 2.03               41.6              5.09</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>                1.48                 4.72               63.9             12.5 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span>              -<span style="color: #BB0000;">13.5</span>                  3.44               29.7            -<span style="color: #BB0000;">10.2</span> </span>
<span class="co">#&gt; <span style="color: #949494;"># ... with 240 more rows, and 3 more variables:</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   awc.sol | change = pctchg &lt;dbl&gt;, esco.hru | change = absval &lt;dbl&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   epco.hru | change = absval &lt;dbl&gt;</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="a-small-calibration-example">A small calibration example<a class="anchor" aria-label="anchor" href="#a-small-calibration-example"></a>
</h2>
<p>There are endless ways to approach a SWAT model calibration. Below I demonstrate a small workflow that could give some ideas on what to consider in a model calibration. The example shows a bare minimum example for calibrating discharge. Real case studies will very likely require more extensive calibration and evaluation depending of the scopes of a model setup. In SWAT model applications other variables such as the in-stream sediment load, or nutrient loads are the variables of interest. This is not covered in this small example.</p>
<p>A few catchment properties that we will use later on in the example I will define already at this point.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Catchment area</span>
<span class="va">cmt_area</span> <span class="op">&lt;-</span> <span class="fl">22261500</span> <span class="co">#m2</span>
<span class="co">#et_avann &lt;- ####</span></code></pre></div>
<div class="section level3">
<h3 id="first-checks">First checks<a class="anchor" aria-label="anchor" href="#first-checks"></a>
</h3>
<p>This does not really involve <code>R</code> or <code>SWATplusR</code> at this point in the model development. But the value of this step is undeniably high. Before starting with any model calibration run your initial model setup (for example in the SWAT+Editor) and check your aggregated and general model results with SWATcheck for example which is implemented in the SWAT+Editor. This gives you a good idea if your model inputs, such as the mean annual precipitation and temperature are plausible. Is the potential evapotranspiration plausible? At this point the model should already include the farm management that you want to implement in the model simulations. Do the plan biomass and the crop yields look plausible? Are crop yields in your region (e.g.Â from agricultural statistics) comparable to the simulated crop yields? Make sure to check these rough boundary conditions and solve any issues at this stage of model development. Any model calibration with wrong inputs or implausible configurations is a waste of time and going back to this step and fixing things is very likely inevitable.</p>
</div>
<div class="section level3">
<h3 id="constraining-et-and-runoff">Constraining ET and runoff<a class="anchor" aria-label="anchor" href="#constraining-et-and-runoff"></a>
</h3>
<p>In a first calibration step I recommend to get a rough idea of the fractions of the water input (i.e.Â precipitation) wich are removed from the system by evapotranspiration and that end up at the main outlet of the catchment (or a subcatchment where observed data is available). The separation of the input water into these two general fractions is mostly controlled by a few SWAT parameters, which are <em>â€˜escoâ€™</em>, <em>â€˜epcoâ€™</em>, <em>â€˜cn2â€™</em>, <em>â€˜awcâ€™</em>, and <em>â€˜percoâ€™</em>. Thus, I would include only these few parameters in a first step to get an idea how changes in these parameters control the simulation of annual evapotranspiration sums. These parameters are of course again included in further calibration steps, but there is a chance to constrain their parameterer ranges already and remove areas in the parameter space that would result in implausible model simulations. This conceptual idea is somehow related to the soft calibration that is available in SWAT+, but the overall approach is different.</p>
<p>Let us define the parameter boundaries for the parameters <em>â€˜escoâ€™</em>, <em>â€˜epcoâ€™</em>, <em>â€˜cn2â€™</em>, <em>â€˜awcâ€™</em>, and <em>â€˜percoâ€™</em>. Unless there is no experience with plausible parameter ranges I would start with very wide ranges in which to vary the parameter values.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">par_bound</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="st">'esco.hru | change = absval'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,
                    <span class="st">'epco.hru | change = absval'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,
                    <span class="st">'cn2.hru | change = abschg'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">25</span>, <span class="fl">10</span><span class="op">)</span>,
                    <span class="st">'awc.sol | change = pctchg'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">50</span>, <span class="fl">50</span><span class="op">)</span>,
                    <span class="st">'perco.hru | change = absval'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Using the recipe from above we draw an LHS sample with 100 parameter combinations. The number here can be lower or higher. I would base that decision on the run time of your model setup and how many simulations you can afford. If the number is too low it may be difficult to see any clear patterns.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n_sample</span> <span class="op">&lt;-</span> <span class="fl">100</span>
<span class="va">n_par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">par_bound</span><span class="op">)</span>

<span class="va">par_et</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lhs/man/randomLHS.html" class="external-link">randomLHS</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_sample</span>, k <span class="op">=</span> <span class="va">n_par</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Perform sampling</span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">.</span>, .name_repair <span class="op">=</span> <span class="st">'minimal'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Convert to a tibble</span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">par_bound</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Assign the parameter names with purrr</span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2_df</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">par_bound</span>, <span class="op">~</span> <span class="op">(</span><span class="va">.x</span> <span class="op">*</span> <span class="op">(</span><span class="va">.y</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">.y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="va">.y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="co"># Scale parameter ranges</span>

<span class="va">par_et</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 100 x 5</span></span>
<span class="co">#&gt;    `esco.hru | change~ `epco.hru | change~ `cn2.hru | change~ `awc.sol | change~</span>
<span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>               0.968               0.696              -<span style="color: #BB0000;">8.07</span>              24.8 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>               0.923               0.809             -<span style="color: #BB0000;">16.3</span>               46.1 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>               0.160               0.823              -<span style="color: #BB0000;">3.96</span>             -<span style="color: #BB0000;">16.1</span> </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>               0.102               0.231              -<span style="color: #BB0000;">7.62</span>             -<span style="color: #BB0000;">12.0</span> </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>               0.523               0.346               5.53              21.6 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>               0.845               0.372             -<span style="color: #BB0000;">15.5</span>               39.5 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>               0.232               0.882              -<span style="color: #BB0000;">5.58</span>              38.2 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>               0.684               0.985              -<span style="color: #BB0000;">8.27</span>             -<span style="color: #BB0000;">29.3</span> </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>               0.446               0.480               8.82              -<span style="color: #BB0000;">1.17</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span>               0.222               0.141             -<span style="color: #BB0000;">12.5</span>               27.2 </span>
<span class="co">#&gt; <span style="color: #949494;"># ... with 90 more rows, and 1 more variable: perco.hru | change = absval &lt;dbl&gt;</span></span></code></pre></div>
<p>We will again use the SWAT+ demo model setup that is available from <code>SWATdata</code>. With <code><a href="../reference/load_demo.html">load_demo()</a></code> we can again save the project in the defined <code>path</code> on the hard drive and return the full path (<code>demo_path</code>) in <code>R</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">demo_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_demo.html">load_demo</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">'project'</span>,
                       path <span class="op">=</span> <span class="st">'Define:/your/path'</span>,
                       version <span class="op">=</span> <span class="st">'plus'</span><span class="op">)</span></code></pre></div>
<p>Using the defined parameter set <code>par_et</code> we will perform the 100 SWAT+ simulations and extract the output variables <em>â€˜flo_outâ€™</em> at the catchment outlet and the average basin evapotranspiration <em>â€˜etâ€™</em> which will be named <code>qout</code> and <code>et</code>, respectively. We will perform the simulations in the time frame <code>start_date = 20000101</code> to <code>end_date = 20121231</code> and evaluate the simulations starting from <code>start_date_print = 20030101</code> which is equivalent to setting <code>years_skip = 3</code>.</p>
<p>To speed up the simulation run time we employ parallel processing simply by setting <code>n_thread</code> to a number larger than 1 to use this number of cores for the execution of the SWAT simulations.</p>
<p>A short sidenote here, I strongly recommend to always set the <code>output_interval = 'daily'</code> which is the default setting in <code><a href="../reference/run_swatplus.html">run_swatplus()</a></code>. A reason for that is that the the simulations are performed with daily time intervals anyways and returning daily outputs do not affect the simulation run time. This gives you the full information of your simulation results, that you can aggregate to other time intervals at any point in your analysis (which I will also show below). This gives you full control over the aggregation and you do not have to rely on what temporal aggregation was performed internally when running SWAT+. An example for that is shown when you run SWAT+ return e.g.Â monthly time intervals and compare the output files <em>â€˜channel_sd_mon.tztâ€™</em> and <em>â€˜channel_sdmorph_mon.txtâ€™</em> and realize that the aggregations for the same variables are different, while the results are equal for daily outputs.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">qout_et</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_swatplus.html">run_swatplus</a></span><span class="op">(</span>project_path <span class="op">=</span> <span class="va">demo_path</span>,
                        output <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>q_out <span class="op">=</span> <span class="fu"><a href="../reference/define_output.html">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'channel_sd'</span>, 
                                                            variable <span class="op">=</span> <span class="st">'flo_out'</span>, 
                                                            unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
                                      et    <span class="op">=</span> <span class="fu"><a href="../reference/define_output.html">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'basin_wb'</span>, 
                                                            variable <span class="op">=</span> <span class="st">'et'</span>, 
                                                            unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
                        parameter <span class="op">=</span> <span class="va">par_et</span>,
                        start_date <span class="op">=</span> <span class="fl">20000101</span>,
                        end_date <span class="op">=</span> <span class="fl">20121231</span>,
                        start_date_print <span class="op">=</span> <span class="fl">20030101</span>,
                        n_thread <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>

<span class="co">#&gt; Building 4 threads in 'Define:/your/path/swatplus_rev60_demo/.model_run': </span>
<span class="co">#&gt;  Completed 4 threads in 0S                                                  </span>
<span class="co">#&gt; Performing 100 simulations on 4 cores: </span>
<span class="co">#&gt;  Completed 100 simulations in 5M 1S   </span></code></pre></div>
<p>Although we returned the simulation results with daily time intervals we want to analyze them on a yearly and average annual basis. Below you find again a recipe to perform the aggregation. The first aggregation is to calculate annual sums. In the second aggregation the average annual value of the sums is calculated. If you require other aggregations, e.g.Â monthly sums, or mean values you can adapt the concept below to your needs. Additionally to the aggregation we also converted the discharge values to specific runoffs. This step helps to better compare the values to precipitation and evapotranspiration sums.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">qout_annual</span> <span class="op">&lt;-</span> <span class="va">qout_et</span><span class="op">$</span><span class="va">simulation</span><span class="op">$</span><span class="va">q_out</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">'run_'</span><span class="op">)</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">.x</span><span class="op">*</span><span class="fl">24</span><span class="op">*</span><span class="fl">3600</span> <span class="op">*</span> <span class="fl">1e3</span> <span class="op">/</span> <span class="va">cmt_area</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">qout_avann</span> <span class="op">&lt;-</span> <span class="va">qout_annual</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">'run_'</span><span class="op">)</span>, .fns <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>For the evaluation of the simulated values we use the observed discharge time series that is available from the demo data in <code>SWATdata</code>. For the comparison we perform the same temporal aggregation above and limit the observed time series to the same time frame as the simulated one.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">qobs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_demo.html">load_demo</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">'obs'</span><span class="op">)</span>

<span class="va">qobs_annual</span> <span class="op">&lt;-</span> <span class="va">qobs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>qobs_mm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">discharge</span><span class="op">*</span><span class="fl">24</span><span class="op">*</span><span class="fl">3600</span> <span class="op">*</span> <span class="fl">1e3</span> <span class="op">/</span> <span class="va">cmt_area</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">qout_annual</span><span class="op">[</span><span class="st">'year'</span><span class="op">]</span>, <span class="va">.</span>, by <span class="op">=</span> <span class="st">'year'</span><span class="op">)</span>
  

<span class="va">qobs_avann</span> <span class="op">&lt;-</span> <span class="va">qobs_annual</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>qobs_mm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">qobs_mm</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Dotty plots are a very simple and effective way to evaluate parameter ranges with respect to any model performance criterium. Below I defined a function to do dotty plots. We will use this function in the following for model evaluation. It is formulated in a very general way. Thus you can use it in any other model evaluations as well as long as the <code>par</code> is a <code>data.frame</code> or <code>tibble</code> with the parameter values and the <code>crit</code> is a vector with the results of you model evaluation with any performance criterium. This vector must have the same length as the number of lines of hte parameter table.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_dotty</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">par</span>, <span class="va">crit</span>, <span class="va">crit_label</span> <span class="op">=</span> <span class="st">'crit'</span>, <span class="va">n_col</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">dotty_tbl</span> <span class="op">&lt;-</span> <span class="va">par</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>crit <span class="op">=</span> <span class="va">crit</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">.</span>, cols <span class="op">=</span> <span class="op">-</span><span class="va">crit</span>, names_to <span class="op">=</span> <span class="st">'parameter'</span><span class="op">)</span>
  
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dotty_tbl</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, y <span class="op">=</span> <span class="va">crit</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">parameter</span>, ncol <span class="op">=</span> <span class="fl">3</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Change of parameter value'</span>, y <span class="op">=</span> <span class="va">crit_label</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>A first simple analysis is to just compare the simulated and the observed mean annual runoff sums. For the comparison we simply calculate the difference between simulated and observed value. The advantage of this simple criterion is that it gives a good idea on the sign and the amplitude of the difference between simulations and observations.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diff_q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="va">qout_avann</span>, <span class="op">~</span> <span class="va">.x</span> <span class="op">-</span> <span class="va">qobs_avann</span><span class="op">$</span><span class="va">qobs_mm</span><span class="op">)</span>

<span class="fu">plot_dotty</span><span class="op">(</span><span class="va">qout_et</span><span class="op">$</span><span class="va">parameter</span><span class="op">$</span><span class="va">values</span>, <span class="va">diff_q</span>, <span class="st">'Difference'</span><span class="op">)</span></code></pre></div>
<p><img src="par_sampl_calib_files/figure-html/unnamed-chunk-16-1.png" width="672"></p>
<p>A similar picture would be given when we analyze the pbias of e.g.Â the annual runoff sums. The pbias metric is available from <code>hydroGOF</code> with the function <code><a href="https://rdrr.io/pkg/hydroGOF/man/pbias.html" class="external-link">pbias()</a></code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pb_q</span> <span class="op">&lt;-</span> <span class="va">qout_annual</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/hydroGOF/man/pbias.html" class="external-link">pbias</a></span><span class="op">(</span><span class="va">.x</span>, <span class="va">qobs_annual</span><span class="op">$</span><span class="va">qobs_mm</span><span class="op">)</span><span class="op">)</span>

<span class="fu">plot_dotty</span><span class="op">(</span><span class="va">qout_et</span><span class="op">$</span><span class="va">parameter</span><span class="op">$</span><span class="va">values</span>, <span class="va">pb_q</span>, <span class="st">'pbias (%)'</span><span class="op">)</span></code></pre></div>
<p><img src="par_sampl_calib_files/figure-html/unnamed-chunk-17-1.png" width="672"></p>
<p>In a second step we can check how well the inter-annual differences are reflected by the performed simulation runs. Again we try to use very simple performance criteria in this evaluation step. To compare the differences in amplitude we use the mean absolute error measure. The mean absolute error is implemented in the package <code>hydroGOF</code> <span class="citation">(<a href="#ref-MZB2017" role="doc-biblioref">Mauricio Zambrano-Bigiarini, 2017</a>)</span> with the function <code><a href="https://rdrr.io/pkg/hydroGOF/man/mae.html" class="external-link">mae()</a></code>. To compare the inter-annual pattern we use the correlation between simulations and observations.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mae_q</span> <span class="op">&lt;-</span> <span class="va">qout_annual</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/hydroGOF/man/mae.html" class="external-link">mae</a></span><span class="op">(</span><span class="va">.x</span>, <span class="va">qobs_annual</span><span class="op">$</span><span class="va">qobs_mm</span><span class="op">)</span><span class="op">)</span>

<span class="fu">plot_dotty</span><span class="op">(</span><span class="va">qout_et</span><span class="op">$</span><span class="va">parameter</span><span class="op">$</span><span class="va">values</span>, <span class="va">mae_q</span>, <span class="st">'MAE'</span><span class="op">)</span></code></pre></div>
<p><img src="par_sampl_calib_files/figure-html/unnamed-chunk-18-1.png" width="672"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cor_q</span> <span class="op">&lt;-</span> <span class="va">qout_annual</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">.x</span>, <span class="va">qobs_annual</span><span class="op">$</span><span class="va">qobs_mm</span><span class="op">)</span><span class="op">)</span>

<span class="fu">plot_dotty</span><span class="op">(</span><span class="va">qout_et</span><span class="op">$</span><span class="va">parameter</span><span class="op">$</span><span class="va">values</span>, <span class="va">cor_q</span>, <span class="st">'correlation'</span><span class="op">)</span></code></pre></div>
<p><img src="par_sampl_calib_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body">
<div id="ref-Carnell2019" class="csl-entry">
Carnell, R.: Lhs: Latin hypercube samples. [online] Available from: <a href="https://CRAN.R-project.org/package=lhs" class="external-link">https://CRAN.R-project.org/package=lhs</a> (Accessed 5 March 2019), 2019.
</div>
<div id="ref-MZB2017" class="csl-entry">
Mauricio Zambrano-Bigiarini: hydroGOF: Goodness-of-fit functions for comparison of simulated and observed hydrological time series., 2017.
</div>
<div id="ref-Mueller2019" class="csl-entry">
MÃ¼ller, K. and Wickham, H.: Tibble: Simple data frames. [online] Available from: <a href="https://CRAN.R-project.org/package=tibble" class="external-link">https://CRAN.R-project.org/package=tibble</a> (Accessed 5 March 2019), 2019.
</div>
<div id="ref-Rcore2019" class="csl-entry">
R Core Team: <span class="nocase">R: A language and environment for statistical computing.</span>, [online] Available from: <a href="https://www.r-project.org/" class="external-link">https://www.r-project.org/</a> (Accessed 5 March 2019), 2019.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Christoph Schuerz.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
