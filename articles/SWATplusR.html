<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting started with SWATplusR • SWATplusR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting started with SWATplusR">
<meta property="og:description" content="SWATplusR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SWATplusR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.5.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/SWATplusR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/chrisschuerz/SWATplusR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting started with SWATplusR</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/chrisschuerz/SWATplusR/blob/HEAD/vignettes/SWATplusR.Rmd" class="external-link"><code>vignettes/SWATplusR.Rmd</code></a></small>
      <div class="hidden name"><code>SWATplusR.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="loading-swatplusr">Loading <code>SWATplusR</code><a class="anchor" aria-label="anchor" href="#loading-swatplusr"></a>
</h2>
<p>If you did not install <code>SWATplusR</code> yet you can do that now running the following lines in <code>R</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># If the package remotes is not installed run first:</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'remotes'</span><span class="op">)</span>

<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">'chrisschuerz/SWATplusR'</span><span class="op">)</span></code></pre></div>
<p>Before we start exploring the package load <code>SWATplusR</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/chrisschuerz/SWATplusR" class="external-link">SWATplusR</a></span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="swat-demo-projects">SWAT demo projects<a class="anchor" aria-label="anchor" href="#swat-demo-projects"></a>
</h2>
<p><code>SWATdata</code> provides a set of fast running, lightweight SWAT2012 and SWAT+ model setups of a head watershed of the Little River Experimental Watershed [LREW; <span class="citation"><a href="#ref-Bosch2007" role="doc-biblioref">Bosch et al.</a> (<a href="#ref-Bosch2007" role="doc-biblioref">2007</a>)</span>]. Additionally, discharge observations at the outlet of the demo catchment (gauge J of LREW) and spatial information of the SWAT model setups are available from <code>SWATdata</code>. The <a href="https://github.com/chrisschuerz/SWATdata#swatdata-" class="external-link"><code>SWATdata</code></a> GitHub page gives an overview of the available data sets.</p>
<div class="section level3">
<h3 id="loading-a-swat-project">Loading a SWAT project<a class="anchor" aria-label="anchor" href="#loading-a-swat-project"></a>
</h3>
<p>Demo data can be loaded with the function <code><a href="../reference/load_demo.html">load_demo()</a></code>. With the input argument <code>dataset</code> you can define which SWAT project data you want to load. To load a SWAT project folder define <code>dataset = 'project'</code>. The <code>path</code> defines the path on your local hard drive where you want to store the SWAT project folder. <strong><em>Caution:</em></strong> *Please try to avoid blanks in your path names (e.g. ‘C:/this is a/path with blanks’). This can cause issues when running the model. Try to use e.g. ’_’ in your path names instead.* As the SWAT project is available as SWAT+ and as SWAT2012 project you have to specify the <code>version</code> of the SWAT project you want to load. Use <code>version = 'plus'</code> to load a SWAT+ project and <code>version = '2012'</code> to load a SWAT2012 version of the project. SWAT+ is under constant development and new model revisions are released from time to time. I try to keep <code>SWATdata</code> and the SWAT+ demo projects up to date and provide at least a few of the last SWAT+ revisions as demo projects. If no <code>revision</code> number is specified the most recent SWAT+ model is loaded. You can, however, also load a SWAT+ project with that was built for a specific SWAT+ revision by providing for example the input argument <code>revision = 59.3</code> to load a SWAT+ revision 59.3 model setup. Please check the <a href="https://github.com/chrisschuerz/SWATdata#swatdata-" class="external-link"><code>SWATdata</code></a> GitHub page to see which model setups are available. The two examples below load the most recent SWAT+ model setup and the available SWAT2012 setup.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># The path where the SWAT demo project will be written</span>
<span class="va">demo_path</span> <span class="op">&lt;-</span> <span class="st">'Define:/your/path'</span>

<span class="co"># Loading a SWAT+ demo project</span>
<span class="va">path_plus</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_demo.html">load_demo</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">'project'</span>,
                       path <span class="op">=</span> <span class="va">demo_path</span>,
                       version <span class="op">=</span> <span class="st">'plus'</span><span class="op">)</span>

<span class="co"># Loading a SWAT2012 demo project</span>
<span class="va">path_2012</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_demo.html">load_demo</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">'project'</span>,
                       path <span class="op">=</span> <span class="va">demo_path</span>,
                       version <span class="op">=</span> <span class="st">'2012'</span><span class="op">)</span></code></pre></div>
<p>In the case of a SWAT project <code><a href="../reference/load_demo.html">load_demo()</a></code> saves the defined SWAT project in the file path that was defined with <code>path = demo_path</code> and returns the final demo project path as a character string in <code>R</code>. I assigned these paths to the variables <code>path_plus</code> and <code>path_2012</code> to use them later in the model runs.</p>
</div>
<div class="section level3">
<h3 id="observation-data">Observation data<a class="anchor" aria-label="anchor" href="#observation-data"></a>
</h3>
<p><code>SWATdata</code> also provides daily discharge records for the outlet of the demo catchment (Gauge J of LREW) for the time period 1968-01-01 until 2012-12-31. Observation data are useful for the model evaluation. These date will be used in several examples with the SWAT demo projects. You can load the observation data again using the function <code><a href="../reference/load_demo.html">load_demo()</a></code>. To access the observation data set you have to define <code>dataset = 'observation'</code>. The other input arguments are not required in this case as the observation data are the same for all demos. When loading the observation data set <code><a href="../reference/load_demo.html">load_demo()</a></code> returns a data frame with a date column and a column for the mean daily discharge at that date. In the code below the observation data frame is assigned to the variable <code>q_obs</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">q_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_demo.html">load_demo</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">'observation'</span><span class="op">)</span>

<span class="va">q_obs</span></code></pre></div>
<pre><code><span class="co">#&gt; <span style="color: #949494;"># A tibble: 16,437 x 2</span></span>
<span class="co">#&gt;    date       discharge</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1968-01-01      0.16</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1968-01-02      0.57</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1968-01-03      0.61</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1968-01-04      0.37</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1968-01-05      0.25</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 1968-01-06      0.2 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 1968-01-07      0.21</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 1968-01-08      0.22</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 1968-01-09      0.18</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 1968-01-10      0.34</span>
<span class="co">#&gt; <span style="color: #949494;"># ... with 16,427 more rows</span></span></code></pre>
<p>A quick plot of the observation data <code>q_obs</code> shows the daily mean discharge at Gauge J for the years 1968 to 2012 in <span class="math inline">\(m^3 s^{-1}\)</span>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">q_obs</span>, type <span class="op">=</span> <span class="st">'l'</span><span class="op">)</span></code></pre></div>
<p><img src="SWATplusR_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="first-swat-model-runs">First SWAT model runs<a class="anchor" aria-label="anchor" href="#first-swat-model-runs"></a>
</h2>
<p>With the functions <code><a href="../reference/run_swatplus.html">run_swatplus()</a></code> and <code><a href="../reference/run_swat2012.html">run_swat2012()</a></code> you can perform simulations in a SWAT+ or a SWAT2012 project folder that is located on the local hard drive. SWAT model simulations write a large range of output variables after a simulation run. Usually only a few variables are analyzed (e.g. in-stream discharge or nutrient loads). With the function <code><a href="../reference/define_output.html">define_output()</a></code> you can specify the output variables that are returned to <code>R</code> after the simulation run. Thus, the minimum information you have to provide to perform a model simulation is where your project is located with the input argument <code>project_path</code> and which simulation outputs should be returned after the simulation defined with the input argument <code>output</code>. The output variables are always specified with the function <code><a href="../reference/define_output.html">define_output()</a></code> and passed through with the input argument <code>output</code>. The example below shows a minimum example for a SWAT+ project.</p>
<div class="section level3">
<h3 id="project_path">
<code>project_path</code><a class="anchor" aria-label="anchor" href="#project_path"></a>
</h3>
<p>As the project path we define the path to the previously loaded demo project <code>project_path = path_plus</code>. If you do not want to work with the demo project, but you already want to use your own SWAT project you can define the path to your SWAT ‘TxtInOut’ folder and simply run simulations there. Be aware in this case that the runtime can be much longer for large projects, which might hinder you in testing many things when first playing around with <code>SWATplusR</code>. The demo projects are designed in a way that simulations should not take longer than a few seconds, depending on the machine where it is executed. If you want to use your own SWAT project please consider a few things:</p>
<ul>
<li>The SWAT project folder must contain exactly one executable file. <code>run_swat*()</code> automatically searches for the one SWAT executable in the project folder. If there are no or more than one executables available in the project folder an error is returned as <code>run_swat*()</code> does not know which executable file to use.</li>
<li>Weather data must be provided with the project as <code>run_swat*()</code> does some checks for which time periods weather data are available.</li>
<li>Make clear to use the right function, ether <code><a href="../reference/run_swatplus.html">run_swatplus()</a></code> to run a SWAT+ project, or <code><a href="../reference/run_swat2012.html">run_swat2012()</a></code> to run a SWAT2012 project.</li>
</ul>
</div>
<div class="section level3">
<h3 id="define_output">
<code>define_output()</code><a class="anchor" aria-label="anchor" href="#define_output"></a>
</h3>
<p>The simple example below defines only one output that is returned to <code>R</code>. The definition follows a simple syntax. <code><a href="../reference/define_output.html">define_output()</a></code> requires three input arguments. The <code>file</code> indicates in which file the SWAT output variable of interest is written. As we want to return the discharge in this example we define <code>file = 'channel_sd'</code>. All output files for SWAT+ are listed in the <em>‘print.prt’</em> of your SWAT+ project. The variable for the discharge that leaves a channel is called <code>'flo_out'</code>. We define <code>variable = 'flo_out'</code>. The third input argument is <code>unit</code>. <code>unit</code> defines for which units, in this case for which channels, we want to extract the output <code>variable</code>. The SWAT+ demo project has only one channel and therefore we define <code>unit = 1</code>. The correct channel ID is listed in the <em>‘chandeg.con’</em> file in the SWAT+ project folder. If you have, many channels and you want to compare your simulation outputs with observation data, make sure to select the correct <code>id</code> that corresponds to your gauge location.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">q_sim_plus</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_swatplus.html">run_swatplus</a></span><span class="op">(</span>project_path <span class="op">=</span> <span class="va">path_plus</span>,
                           output <span class="op">=</span> <span class="fu"><a href="../reference/define_output.html">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'channel_sd'</span>,
                                                  variable <span class="op">=</span> <span class="st">'flo_out'</span>,
                                                  unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="co">#&gt; Building 1 thread in 'Define:/your/path/swatplus_demo/.model_run':</span>
<span class="co">#&gt;  Thread 1 of 1   Time elapsed: 0S   Time remaining: 0S    </span>
<span class="co">#&gt;  Completed 1 thread in 0S</span>
<span class="co">#&gt; Performing 1 simulation on 1 core:</span>
<span class="co">#&gt;  Simulation 1 of 1   Time elapsed: 3S   Time remaining: 0S</span>
<span class="co">#&gt;  Completed 1 simulation in 3S</span></code></pre></div>
<p>The syntax of <code><a href="../reference/define_output.html">define_output()</a></code> that was shown above for SWAT+ is the same for SWAT2012 projects. The only difference between the two models in the output definition is how to correctly address the output variables. The output files are organized differently in SWAT+ and SWAT2012. SWAT2012 simulations generate output files that are called <em>‘output.’</em> followed by a suffix that defines the type of output. Subbasin outputs are stored in the <em>‘.sub’</em> file, HRU outputs in the <em>‘.hru’</em> file, and channel outputs for example in the ’<em>.rch’</em> file. This list is not comprehensive and there are further output files. If you want to return variables from other SWAT2012 output files please please go through the <em>‘output.’</em> files in your project folder after performing a simulation run. In the minimum example we define <code>file = 'rch'</code> to access the channel output file. The variable <em>‘FLOW_OUT’</em> defines the discharge that leaves a channel. Therefore, we define <code>variable = 'FLOW_OUT'</code>. <strong><em>Caution:</em></strong> <em>Be aware that the variable definition is case sensitive and variables in SWAT2012 are usually upper case.</em> The SWAT2012 demo project has in total 3 channels. In the output definition we can also define multiple units for which we want to extract outputs. In the example below we define <code>unit = 1:3</code> which means that we return the <em>‘FLOW_OUT’</em> for the channel units 1,2, and 3.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">q_sim_2012</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_swat2012.html">run_swat2012</a></span><span class="op">(</span>project_path <span class="op">=</span> <span class="va">path_2012</span>,
                           output <span class="op">=</span> <span class="fu"><a href="../reference/define_output.html">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'rch'</span>,
                                                  variable <span class="op">=</span> <span class="st">'FLOW_OUT'</span>,
                                                  unit <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span>

<span class="co">#&gt; Building 1 thread in 'Define:/your/path/swat2012_demo/.model_run':</span>
<span class="co">#&gt;  Thread 1 of 1   Time elapsed: 3S   Time remaining: 0S    </span>
<span class="co">#&gt;  Completed 1 thread in 3S</span>
<span class="co">#&gt; Performing 1 simulation on 1 core:</span>
<span class="co">#&gt;  Simulation 1 of 1   Time elapsed: 4S   Time remaining: 0S</span>
<span class="co">#&gt;  Completed 1 simulation in 4S</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="output-definition">Output definition<a class="anchor" aria-label="anchor" href="#output-definition"></a>
</h2>
<p>The previous examples illustrated how to extract one <code>variable</code> (but maybe for several <code>units</code>) from the simulation outputs. To extract several variables you can simply combine them in a <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code>. In the example below we extract several water balance components of the SWAT+ demo simulations. Aggregated variables for a SWAT+ simulation are written to the <em>‘basin_wb’</em> file and there is only one spatial unit (the entire basin) written to that file. Therefore, the <code>unit</code> must be 1. Values different from 1 will not return any simulation results:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">wb_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_swatplus.html">run_swatplus</a></span><span class="op">(</span>project_path <span class="op">=</span> <span class="va">path_plus</span>,
           output <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>precip <span class="op">=</span> <span class="fu"><a href="../reference/define_output.html">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"basin_wb"</span>,
                                                variable <span class="op">=</span> <span class="st">"precip"</span>,
                                                unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
                         q_sur  <span class="op">=</span> <span class="fu"><a href="../reference/define_output.html">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"basin_wb"</span>,
                                                variable <span class="op">=</span> <span class="st">"surq_gen"</span>,
                                                unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
                         q_lat  <span class="op">=</span> <span class="fu"><a href="../reference/define_output.html">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"basin_wb"</span>,
                                                variable <span class="op">=</span> <span class="st">"latq"</span>,
                                                unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
                         eta    <span class="op">=</span> <span class="fu"><a href="../reference/define_output.html">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"basin_wb"</span>,
                                                variable <span class="op">=</span> <span class="st">"et"</span>,
                                                unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co">#&gt; Building 1 thread in 'Define:/your/path/swatplus_demo/.model_run':</span>
<span class="co">#&gt;  Thread 1 of 1   Time elapsed: 1S   Time remaining: 0S    </span>
<span class="co">#&gt;  Completed 1 thread in 1S</span>
<span class="co">#&gt; Performing 1 simulation on 1 core:</span>
<span class="co">#&gt;  Simulation 1 of 1   Time elapsed: 2S   Time remaining: 0S</span>
<span class="co">#&gt;  Completed 1 simulation in 2S</span></code></pre></div>
<p>The output definition in a list has the additional advantage to optionally assign individual names to the variables (e.g. <code>list(name_a = define_output(...))</code>). The variables are returned in the output with that name in R then.</p>
<div class="section level3">
<h3 id="exploring-a-simulation">Exploring a simulation<a class="anchor" aria-label="anchor" href="#exploring-a-simulation"></a>
</h3>
<p>The goal of <code>SWATplusR</code> is to return the SWAT simulations in a <em>tidy</em> format. The simulation results look slightly different if only one simulation was performed, parameters were modified in a run, or multiple parameter sets were used to perform a large number of model evaluations. In general the outputs follow a general structure.</p>
<p>If only one simulation was performed, where no model parameters were modified, <code>run_swat*()</code> returns a <code>tibble</code> <span class="citation">(<a href="#ref-Mueller2019" role="doc-biblioref">Müller and Wickham, 2019</a>)</span> with a <code>date</code> column and the columns with the simulated values of the extracted variables. The output table of the simulated water balance components has a date column and columns with the four extracted water balance components. The variable names are the individual names that we defined in the output definition:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">wb_sim</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 3,653 x 5</span></span>
<span class="co">#&gt;    date       precip q_sur q_lat   eta</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2003-01-01  4.28  0.144 2.28  0.425</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2003-01-02  0.387 0.021 1.68  0.951</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2003-01-03  0     0.005 1.34  0.081</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2003-01-04  0     0.001 1.15  0.742</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2003-01-05  0     0     1.03  0.7  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2003-01-06  0     0     0.962 0.676</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2003-01-07  0     0     0.912 0.574</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2003-01-08  0     0     0.874 0.628</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2003-01-09  0     0     0.844 0.716</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2003-01-10  0     0     0.817 0.423</span>
<span class="co">#&gt; <span style="color: #949494;"># ... with 3,643 more rows</span></span></code></pre></div>
<p>In case no variable name is assigned in the output definition (as in the simulations of the discharge above), the variable name of the extracted variable is used as the variable name. When several units are defined in <code><a href="../reference/define_output.html">define_output()</a></code> (e.g. in the example above <code>unit = 1:3</code>) a column in the output table is created for each unit and the unit number is added to the variable name. This is the case for the the simulation of <em>‘FLOW_OUT’</em> in the example above:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">q_sim_2012</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 3,653 x 4</span></span>
<span class="co">#&gt;    date       FLOW_OUT_1 FLOW_OUT_2 FLOW_OUT_3</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2003-01-01      0.174     0.103       0.413</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2003-01-02      0.154     0.095<span style="text-decoration: underline;">6</span>      0.377</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2003-01-03      0.150     0.093<span style="text-decoration: underline;">5</span>      0.369</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2003-01-04      0.148     0.092<span style="text-decoration: underline;">1</span>      0.363</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2003-01-05      0.146     0.091<span style="text-decoration: underline;">2</span>      0.359</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2003-01-06      0.145     0.090<span style="text-decoration: underline;">6</span>      0.357</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2003-01-07      0.144     0.090<span style="text-decoration: underline;">1</span>      0.355</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2003-01-08      0.144     0.089<span style="text-decoration: underline;">7</span>      0.354</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2003-01-09      0.143     0.089<span style="text-decoration: underline;">4</span>      0.353</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2003-01-10      0.143     0.089<span style="text-decoration: underline;">0</span>      0.352</span>
<span class="co">#&gt; <span style="color: #949494;"># ... with 3,643 more rows</span></span></code></pre></div>
<p>The <em>tidy</em> writing of the simulation results allows an easy processing of the data in the analysis workflow in R. Here is a quick example how to ‘wrangle’ the simulated discharge data with <code>dplyr</code> <span class="citation">(<a href="#ref-Wickham2019" role="doc-biblioref">Wickham et al., 2019</a>)</span> and <code>tidyr</code> <span class="citation">(<a href="#ref-Wickham2018a" role="doc-biblioref">Wickham and Henry, 2018</a>)</span> and plotting it with <code>ggplot2</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>
<span class="co">#&gt; Warning: package 'tidyr' was built under R version 4.1.2</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>

<span class="va">q_plot</span> <span class="op">&lt;-</span> <span class="va">q_sim_2012</span> <span class="op"><a href="https://tidyr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">FLOW_OUT_3</span><span class="op">)</span> <span class="op"><a href="https://tidyr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>q_sim <span class="op">=</span> <span class="va">FLOW_OUT_3</span><span class="op">)</span> <span class="op"><a href="https://tidyr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">q_obs</span>, by <span class="op">=</span> <span class="st">"date"</span><span class="op">)</span> <span class="op"><a href="https://tidyr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>q_obs <span class="op">=</span> <span class="va">discharge</span><span class="op">)</span> <span class="op"><a href="https://tidyr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">gather</a></span><span class="op">(</span><span class="va">.</span>, key <span class="op">=</span> <span class="st">"variable"</span>, value <span class="op">=</span> <span class="st">"discharge"</span>, <span class="op">-</span><span class="va">date</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">q_plot</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">discharge</span>, col <span class="op">=</span> <span class="va">variable</span>, lty <span class="op">=</span> <span class="va">variable</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"tomato3"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="SWATplusR_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="model-parameter-alteration">Model parameter alteration<a class="anchor" aria-label="anchor" href="#model-parameter-alteration"></a>
</h2>
<p>The capability to alter model parameters in a SWAT simulation is an essential option in <code>SWATplusR</code>. Model parameters can be modified in a SWAT simulation by passing the respective parameters with the argument <code>parameter</code> in <code>run_swat*()</code>. A single parameter set can be provided as a vector. Many parameter sets that should be used in simulations have to be provided in a <code>tibble</code>.</p>
<p>To modify a model parameter information on the type of change (relative, absolute change etc.), the extent of the change (e.g. all or selected subbasins/land uses/ soil types etc.) and the magnitude of change are required. In <code>SWATplusR</code> most of that information is passed with the variable name. Thus, the variable names use a very specific syntax. A parameter name can consist of several parts, where some are required and others are optional. The minimum requirements for the elements of a parameter name are the actual name of the parameter in the model an the type of change. Options for the type of change are <em>‘relchg’</em> and <em>‘pctchg’</em> to alter a parameter by a fraction or a percentage of the initial parameter value, <em>“abschg”</em> to add an absolute value to the initial parameter value, or <em>“absval”</em> to replace a parameter by an absolute value. In the example below the parameter curve number (‘cn2’) that is defined on HRU level will be increased by the absolute value 5 in all HRUs.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">par_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cn2.hru|change = abschg"</span> <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<p>Many options to constrain a parameter change are available in <code>SWATplusR</code> (<em>in the current version of <code>SWATplusR</code> only for SWAT2012</em>). Constraints for the alteration of a parameter is added with a ‘|’ and a logical expression. Below you find an example for the change of the curve number ‘CN2’ in a SWAT2012 setup, that is only effective for the subbasins 1 to 5 and only for the land uses “WWHT” and “CORN.” Also take care that ‘CN2’ is a parameter of the ‘.mgt’ input file:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">par_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CN2.mgt|change = abschg | sub == 1:5 | luse %in% c('WWHT', 'CORN') "</span> <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<p>Individual parameter names can be assigned with the <code>::</code> operator. At the beginning of a parameter definition the individual parameter name is provided followed by ‘::’ and the actual parameter definition:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">par_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"my_name::cn2.hru|change = abschg"</span> <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<div class="section level3">
<h3 id="simulation-with-a-single-parameter-set">Simulation with a single parameter set<a class="anchor" aria-label="anchor" href="#simulation-with-a-single-parameter-set"></a>
</h3>
<p>To define single parameter set a named vector is generated. The names define the parameters the type of change. Below a single parameter set is generated where all ‘cn2’ values in a SWAT+ model setup are reduced by 5 percent and the ‘alpha.gw’ value was set to 0.5 globally.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">par_single</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cn2.hru|change = pctchg"</span> <span class="op">=</span> <span class="op">-</span> <span class="fl">5</span>,
                <span class="st">"alpha.gw|change = absval"</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p>To include the parameter changes in the SWAT+ model execution the defined vector is simply passed with the argument <code>parameter</code> in the <code><a href="../reference/run_swatplus.html">run_swatplus()</a></code> function call:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">q_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_swatplus.html">run_swatplus</a></span><span class="op">(</span>project_path <span class="op">=</span> <span class="va">path_plus</span>,
                      output <span class="op">=</span> <span class="fu"><a href="../reference/define_output.html">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"channel"</span>,
                                             variable <span class="op">=</span> <span class="st">"flo_out"</span>,
                                             unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
                      parameter <span class="op">=</span> <span class="va">par_single</span><span class="op">)</span>

<span class="co">#&gt; Building 1 thread in 'Define:/your/path/swatplus_demo/.model_run':</span>
<span class="co">#&gt;  Thread 1 of 1   Time elapsed: 1S   Time remaining: 0S    </span>
<span class="co">#&gt;  Completed 1 thread in 1S</span>
<span class="co">#&gt; Performing 1 simulation on 1 core:</span>
<span class="co">#&gt;  Simulation 1 of 1   Time elapsed: 2S   Time remaining: 0S</span>
<span class="co">#&gt;  Completed 1 simulation in 2S</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="simulations-with-many-parameter-sets">Simulations with many parameter sets<a class="anchor" aria-label="anchor" href="#simulations-with-many-parameter-sets"></a>
</h3>
<p>The same workflow works with several parameter sets when they are defined in a <code>tibble</code>. The example below uses the same parameters as above, but in this case a <code>tibble</code> was defined with 8 random realizations for each parameter within the defined boundaries.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">par_set</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="st">"cn2.hru|change = abschg"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">8</span>,<span class="op">-</span><span class="fl">15</span>,<span class="fl">10</span><span class="op">)</span>,
                  <span class="st">"alpha.gw|change = absval"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">par_set</span></code></pre></div>
<p>The implementation in the <code>run_swat*()</code> function works the same way. To execute multiple SWAT simulations with many parameter sets the <code>SWATplusR</code> package provides an option parallel computing. To perform a parallel model execution the number of parallel threads is defined with the input argument <code>n_thread</code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">q_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_swatplus.html">run_swatplus</a></span><span class="op">(</span>project_path <span class="op">=</span> <span class="va">path_plus</span>,
                      output <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>q_sur  <span class="op">=</span> <span class="fu"><a href="../reference/define_output.html">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"basin_wb"</span>,
                                                           variable <span class="op">=</span> <span class="st">"surq_gen"</span>,
                                                           unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
                                    q_lat  <span class="op">=</span> <span class="fu"><a href="../reference/define_output.html">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"basin_wb"</span>,
                                                           variable <span class="op">=</span> <span class="st">"latq"</span>,
                                                           unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
                      parameter <span class="op">=</span> <span class="va">par_set</span>,
                      n_thread <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>

<span class="co">#&gt; Building 4 threads in 'Define:/your/path/swatplus_demo/.model_run':</span>
<span class="co">#&gt;  Thread 2 of 4   Time elapsed: 1S   Time remaining: 1S    </span>
<span class="co">#&gt;  Completed 4 thread in 2S</span>
<span class="co">#&gt; Performing 8 simulations on 4 cores:</span>
<span class="co">#&gt;  Simulation 4 of 8   Time elapsed: 4S   Time remaining: 4S</span>
<span class="co">#&gt;  Completed 8 simulations in 11S</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="exploring-simulations-with-parameter-alterations">Exploring simulations with parameter alterations<a class="anchor" aria-label="anchor" href="#exploring-simulations-with-parameter-alterations"></a>
</h3>
<p>When parameters were altered in a simulation run, the performed parameter changes are saved in the simulation outputs by default. As a consequence, the entire simulation output cannot be provided in a single <code>tibble</code> anymore and will be returned as a list with two main list entries. <code>output$parameter</code> provides all information on the parameter changes that were performed in the simulation runs. <code>output$simulation</code> provides the simulation results. The outputs of the previous model execution of the SWAT+ demo project has the following structure</p>
<p>The list entry <code>$parameter</code> holds two <code>tibbles</code>. The first <code>tibble</code> shows the values of the parameter changes of each model evaluation that was performed with <code>run_swat*()</code>. Each row of the <code>tibble</code> represents a parameter set that was used in a model run. The second <code>tibble</code> provides information on the parameter names, their actual names in the model, the type of change and the constraints on the parameter:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">q_sim</span><span class="op">$</span><span class="va">parameter</span>
<span class="co">#&gt; $values</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 x 2</span></span>
<span class="co">#&gt;        cn2 alpha</span>
<span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>   0.360  0.401</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> -<span style="color: #BB0000;">11.3</span>    0.151</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> -<span style="color: #BB0000;">11.1</span>    0.752</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  -<span style="color: #BB0000;">5.67</span>   0.608</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  -<span style="color: #BB0000;">9.94</span>   0.590</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span>   8.37   0.571</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">7</span>   4.52   0.408</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">8</span>   0.023<span style="text-decoration: underline;">0</span> 0.115</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $definition</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 x 4</span></span>
<span class="co">#&gt;   par_name parameter file_name change</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> cn2      cn2       hru       abschg</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> alpha    alpha     gw        absval</span></code></pre></div>
<p>The list entry <code>$simulation</code> provides the simulation runs that corresponds to each parameter set. Different to the single simulation without parameter changes is that now the simulated variables are not saved in a single <code>tibble</code>, but as a <code>list</code> of <code>tibbles</code>. In this case each simulated variable is saved in one <code>tibble</code>, where the first column of each <code>tibble</code> is the ‘date’ and the other columns are the individual simulation runs. Now the tibbles are named by the variables and each individual run saved in the tibbles is named ‘run_1’ to run ‘run_n.’ In the example two variables were simulated, <code>q_out$simulation$q_sur</code> and <code>q_out$simulation$q_lat</code>. Each <code>tibble</code> holds the date and the runs 1 to 8:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">q_sim</span><span class="op">$</span><span class="va">simulation</span>
<span class="co">#&gt; $q_sur</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 3,653 x 9</span></span>
<span class="co">#&gt;    date       run_1 run_2 run_3 run_4 run_5 run_6 run_7 run_8</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2003-01-01 0.149 0.023 0.024 0.059 0.029 0.335 0.221 0.144</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2003-01-02 0.022 0.003 0.003 0.009 0.004 0.053 0.035 0.021</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2003-01-03 0.005 0.001 0.001 0.002 0.001 0.013 0.008 0.005</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2003-01-04 0.001 0     0     0.001 0     0.003 0.002 0.001</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2003-01-05 0     0     0     0     0     0.001 0.001 0    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2003-01-06 0     0     0     0     0     0     0     0    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2003-01-07 0     0     0     0     0     0     0     0    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2003-01-08 0     0     0     0     0     0     0     0    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2003-01-09 0     0     0     0     0     0     0     0    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2003-01-10 0     0     0     0     0     0     0     0    </span>
<span class="co">#&gt; <span style="color: #949494;"># ... with 3,643 more rows</span></span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $q_lat</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 3,653 x 9</span></span>
<span class="co">#&gt;    date       run_1 run_2 run_3 run_4 run_5 run_6 run_7 run_8</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2003-01-01 2.27  2.52  2.52  2.44  2.51  1.81  2.06  2.28 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2003-01-02 1.67  1.9   1.90  1.82  1.89  1.32  1.51  1.68 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2003-01-03 1.34  1.54  1.54  1.47  1.53  1.05  1.21  1.34 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2003-01-04 1.14  1.32  1.32  1.26  1.31  0.894 1.03  1.15 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2003-01-05 1.03  1.19  1.19  1.13  1.18  0.802 0.931 1.03 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2003-01-06 0.956 1.10  1.10  1.05  1.10  0.744 0.866 0.961</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2003-01-07 0.906 1.04  1.04  0.994 1.03  0.704 0.822 0.911</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2003-01-08 0.869 0.995 0.994 0.952 0.988 0.675 0.788 0.874</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2003-01-09 0.838 0.957 0.956 0.917 0.95  0.651 0.761 0.843</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2003-01-10 0.812 0.925 0.925 0.888 0.919 0.63  0.737 0.817</span>
<span class="co">#&gt; <span style="color: #949494;"># ... with 3,643 more rows</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="saving-and-loading-simulations">Saving and loading Simulations<a class="anchor" aria-label="anchor" href="#saving-and-loading-simulations"></a>
</h2>
<p>In many cases it is advantageous to save the simulations incrementally after each model evaluation, for instance when long simulation runs would be lost if the computer or the R instance crashes, or when the simulation results cannot be stored in the RAM storage at all.</p>
<p>Simulations can be saved incrementally in an <em>SQLite</em> data base on the local hard drive, by passing a name for the save folder with the argument <code>save_file</code> in <code>run_swat*()</code>. By default the data base with the name <code>save_file</code> is saved in the project folder. An individual path for the <code>save_file</code> can be defined with the argument <code>save_path</code>. In case the simulations should be only saved in the data base and not returned back to R, the argument <code>return_output = FALSE</code> has to be set.</p>
<p>These arguments are simply added to the <code><a href="../reference/run_swatplus.html">run_swatplus()</a></code> function call to save the simulations in a data base instead of returning them back to R. Below the arguments are added to the previous simulation:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/run_swatplus.html">run_swatplus</a></span><span class="op">(</span>project_path <span class="op">=</span> <span class="va">path_plus</span>,
            output <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>q_sur  <span class="op">=</span> <span class="fu"><a href="../reference/define_output.html">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"basin_wb"</span>,
                                                 variable <span class="op">=</span> <span class="st">"surq_gen"</span>,
                                                 unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
            q_lat  <span class="op">=</span> <span class="fu"><a href="../reference/define_output.html">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"basin_wb"</span>,
                                   variable <span class="op">=</span> <span class="st">"latq"</span>,
                                   unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
            parameter <span class="op">=</span> <span class="va">par_set</span>,
            n_thread <span class="op">=</span> <span class="fl">4</span>,
            save_file <span class="op">=</span> <span class="st">"q_sur_lat"</span>,
            return_output <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co">#&gt; Building 4 threads in 'Define:/your/path/swatplus_demo/.model_run':</span>
<span class="co">#&gt;  Thread 2 of 4   Time elapsed: 1S   Time remaining: 1S    </span>
<span class="co">#&gt;  Completed 4 thread in 2S</span>
<span class="co">#&gt; Performing 8 simulations on 4 cores:</span>
<span class="co">#&gt;  Simulation 4 of 8   Time elapsed: 3S   Time remaining: 3S</span>
<span class="co">#&gt;  Completed 8 simulations in 8S</span></code></pre></div>
<p>You can see that the function did not return any results in R but generated a folder that we called “q_sur_lat” passed by the argument <code>save_file</code> in the project folder. That folder now contains several data bases. The first data base is called “par_dat.sqlite” and stores the parameter information and the date vector. Further, each of the parallel threads of the simulation generated a data base where each thread wrote the simulation results (This is necessary to avoid access conflicts when writing to data bases in parallel). The simulation data bases are always called “sim_thread_i.sqlite,” where “i” are the indexes of the individual threads (1 to 4 in this case).</p>
<p><code>SWATplusR</code> provides two options to access the saved simulations. Loading large data bases into the R environment can take a long time. If you only want to know the the content of saved simulations (e.g. to check the successful simulation runs after a crash) you can scan the saved runs with the function <code><a href="../reference/scan_swat_run.html">scan_swat_run()</a></code>. The function writes meta information on the saved SWAT simulations into the console. The function returns the following for our saved runs:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Set the path to the folder where the date bases were saved</span>
<span class="va">path_saved_q</span> <span class="op">&lt;-</span> <span class="st">"Path:/to/the/folder/q_sur_lat"</span>

<span class="fu"><a href="../reference/scan_swat_run.html">scan_swat_run</a></span><span class="op">(</span>save_dir <span class="op">=</span> <span class="va">path_saved_q</span><span class="op">)</span>
<span class="co">#&gt; Simulation period:</span>
<span class="co">#&gt;  2003-01-01 to 2012-12-31</span>
<span class="co">#&gt;</span>
<span class="co">#&gt; Simulated variables:</span>
<span class="co">#&gt; q_lat: runs 1 to 8</span>
<span class="co">#&gt; q_sur: runs 1 to 8</span>
<span class="co">#&gt;</span>
<span class="co">#&gt; Parameter set:</span>
<span class="co">#&gt; # A tibble: 8 x 2</span>
<span class="co">#&gt;        cn2 alpha</span>
<span class="co">#&gt;      &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1   0.360  0.401</span>
<span class="co">#&gt; 2 -11.3    0.151</span>
<span class="co">#&gt; 3 -11.1    0.752</span>
<span class="co">#&gt; 4  -5.67   0.608</span>
<span class="co">#&gt; 5  -9.94   0.590</span>
<span class="co">#&gt; 6   8.37   0.571</span>
<span class="co">#&gt; 7   4.52   0.408</span>
<span class="co">#&gt; 8   0.0230 0.115</span>
<span class="co">#&gt; # A tibble: 2 x 4</span>
<span class="co">#&gt;   par_name parameter file_name change</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;</span>
<span class="co">#&gt; 1 cn2      cn2       hru       abschg</span>
<span class="co">#&gt; 2 alpha    alpha     gw        absval</span></code></pre></div>
<p><code><a href="../reference/scan_swat_run.html">scan_swat_run()</a></code> returns information on the simulation period, which output variables were saved and which simulation runs were executed for these variables. Further, information on the used model parameter sets is written.</p>
<p>With <code><a href="../reference/load_swat_run.html">load_swat_run()</a></code> you can then load the simulations saved in the data bases. In case the entire set of simulations cannot be loaded in to the RAM storage the function provides the option to only load parts of the saved simulations. In the example below for example we load only the variable “q_lat” and only the first three runs into R:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">q_subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_swat_run.html">load_swat_run</a></span><span class="op">(</span>save_dir <span class="op">=</span> <span class="va">path_saved_q</span>,
                          variable <span class="op">=</span> <span class="st">"q_lat"</span>,
                          run <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">q_subset</span>
<span class="co">#&gt; $parameter</span>
<span class="co">#&gt; $parameter$values</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 x 2</span></span>
<span class="co">#&gt;        cn2 alpha</span>
<span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>   0.360  0.401</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> -<span style="color: #BB0000;">11.3</span>    0.151</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> -<span style="color: #BB0000;">11.1</span>    0.752</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  -<span style="color: #BB0000;">5.67</span>   0.608</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  -<span style="color: #BB0000;">9.94</span>   0.590</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span>   8.37   0.571</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">7</span>   4.52   0.408</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">8</span>   0.023<span style="text-decoration: underline;">0</span> 0.115</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $parameter$definition</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 x 4</span></span>
<span class="co">#&gt;   par_name parameter file_name change</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> cn2      cn2       hru       abschg</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> alpha    alpha     gw        absval</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $simulation</span>
<span class="co">#&gt; $simulation$q_lat</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 3,653 x 4</span></span>
<span class="co">#&gt;    date                run_1 run_2 run_3</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2003-01-01 <span style="color: #949494;">00:00:00</span> 2.27  2.52  2.52 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2003-01-02 <span style="color: #949494;">00:00:00</span> 1.67  1.9   1.90 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2003-01-03 <span style="color: #949494;">00:00:00</span> 1.34  1.54  1.54 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2003-01-04 <span style="color: #949494;">00:00:00</span> 1.14  1.32  1.32 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2003-01-05 <span style="color: #949494;">00:00:00</span> 1.03  1.19  1.19 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2003-01-06 <span style="color: #949494;">00:00:00</span> 0.956 1.10  1.10 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2003-01-07 <span style="color: #949494;">00:00:00</span> 0.906 1.04  1.04 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2003-01-08 <span style="color: #949494;">00:00:00</span> 0.869 0.995 0.994</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2003-01-09 <span style="color: #949494;">00:00:00</span> 0.838 0.957 0.956</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2003-01-10 <span style="color: #949494;">00:00:00</span> 0.812 0.925 0.925</span>
<span class="co">#&gt; <span style="color: #949494;"># ... with 3,643 more rows</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="further-swatplusr-input-arguments">Further <code>SWATplusR</code> input arguments<a class="anchor" aria-label="anchor" href="#further-swatplusr-input-arguments"></a>
</h2>
<p>The functions <code><a href="../reference/run_swat2012.html">run_swat2012()</a></code> and <code><a href="../reference/run_swatplus.html">run_swatplus()</a></code> have many further input arguments that allow to control important settings of a SWAT simulation. Here I will just mention a few of the essential ones. A detailed overview of the input arguments is provided in the respective function documentations. The simulation period can be controlled with the arguments <code>start_date</code> and <code>end_date</code>. The format writing the outputs of the simulations in the SWAT project folder is controlled by the arguments <code>output_interval</code> to define whether the simulations are written with daily, monthly or yearly time steps, <code>years_skip</code> to define the simulated years that should be skipped for writing the simulation outputs. With the argument <code>run_index</code> a subset of the provided parameter combinations can be simulated. This is useful, when for instance distributing the simulations on multiple computers, or when continuing the simulations after a crash.</p>
<p>You might have noticed, that running SWAT also provides information on the progress. This is very convenient for long simulation runs with many model evaluations. If you implement the SWAT function into other function calls the writing to the console can be an undesired behavior. You can quiet the function call with the argument <code>quiet = TRUE</code>.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body">
<div id="ref-Bosch2007" class="csl-entry">
Bosch, D. D., Sheridan, J. M., Lowrance, R. R., Hubbard, R. K., Strickland, T. C., Feyereisen, G. W. and Sullivan, D. G.: Little river experimental watershed database, Water Resources Research, 43(9), doi:<a href="https://doi.org/10.1029/2006wr005844" class="external-link">10.1029/2006wr005844</a>, 2007.
</div>
<div id="ref-Mueller2019" class="csl-entry">
Müller, K. and Wickham, H.: Tibble: Simple data frames. [online] Available from: <a href="https://CRAN.R-project.org/package=tibble" class="external-link">https://CRAN.R-project.org/package=tibble</a> (Accessed 5 March 2019), 2019.
</div>
<div id="ref-Wickham2018a" class="csl-entry">
Wickham, H. and Henry, L.: Tidyr: Easily tidy data with ’spread()’ and ’gather()’ functions. [online] Available from: <a href="https://CRAN.R-project.org/package=tidyr" class="external-link">https://CRAN.R-project.org/package=tidyr</a> (Accessed 3 May 2019), 2018.
</div>
<div id="ref-Wickham2019" class="csl-entry">
Wickham, H., François, R., Henry, L. and Müller, K.: Dplyr: A grammar of data manipulation. [online] Available from: <a href="https://CRAN.R-project.org/package=dplyr" class="external-link">https://CRAN.R-project.org/package=dplyr</a> (Accessed 5 March 2019), 2019.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Christoph Schuerz.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
